index="main" | eval temp=split(correlationId,"-") | eval clientname=mvindex(split(correlationId,"-"),0) |rename appName as domain | join type=outer domain [search source="app_vcore.json"] | table appName, correlationId, domain, workers.type.cpu, domain workers.type.weight, workers.totalOrgWorkers, workers.amount,workers.type.memory, workers.remainingOrgWorkers, source, sourcetype, clientname | eval appUsage=workers.type.weight * workers.amount | fields "amount", "appName", "appUsage", "clientname", "correlationId", "domain", "source", "sourcetype", "type", "weight", "workers", "workers.amount", "workers.remainingOrgWorkers", "workers.totalOrgWorkers", "workers.type.cpu", "workers.type.memory", "workers.type.weight" | eval "coreReserved"='workers.type.weight' / 'workers.remainingOrgWorkers' * 'workers.totalOrgWorkers' | search "clientname" = "*" | search "clientname" != "" OR "clientname" != "*${ctx:correlationId}*" | search "correlationId" != "*${ctx:correlationId}*" | stats dc(correlationId) as countCorrealation, median(workers.type.weight), mean(coreReserved), dc(sourcetype), count(appUsage), dc(appUsage), count by domain, clientname  | rename "mean(coreReserved)" AS "coreReserved" | eventstats sum(countCorrealation) as countApp by domain | eval "appUsage"= 'countCorrealation' / countApp | eval "appUsageCost"='appUsage'* 'coreReserved' * 10000

